## CloudFormation

Started off CloudFormation with a guest instructor __Rohini Gaonkar, an AWS Sr. Dev__ Advocate leading instruction along with Andrew. We walked through setting up a basic CloudFormation template deploying an ECS Cluster. We also created a deploy script that deployed the cluster, along with a new S3 bucket named cfn-artifacts-1. In addition to this, we add a task to our .gitpod.yml file to install cfn-lint. Per ChatGPT, "cfn-lint is a tool used for linting CloudFormation templates, which checks for syntactical errors, best practices, and adherence to standards. It ensures the correctness and quality of the CloudFormation template."



# Networking Layer

Moving onto main instruction, we now have a cfn folder created in aws directory. We create a new folder within this directory named networking. Next we create a new file in this folder named template.yaml. We begin, just fleshing out the template.yaml, commenting what we're going to need.

```
AWSTemplateFormatVersion: 2010-09-09

# VPC
# IGW
# Route Tables
# Subnets
# Subnet A
# Subnet B
# Subnet C
```

![Screenshot 2024-03-03 172113](https://github.com/bhanumalhotra123/aws-bootcamp-cruddur-2023/assets/144083659/cda9c73e-b07b-4c9a-aa8c-80eeb26d6b0d)

![Screenshot 2024-03-03 172132](https://github.com/bhanumalhotra123/aws-bootcamp-cruddur-2023/assets/144083659/5b24d319-f257-4cce-9f28-c6f2db3d86bd)

![Screenshot 2024-03-03 221205](https://github.com/bhanumalhotra123/aws-bootcamp-cruddur-2023/assets/144083659/49602e32-4812-4abd-9159-0268203e477d)
![Screenshot 2024-03-03 221621](https://github.com/bhanumalhotra123/aws-bootcamp-cruddur-2023/assets/144083659/16797595-d82e-452b-a9ef-a2f034c32919)

We immediately consult AWS documentation for the VPC, which in CloudFormation is known as AWS::EC2::VPC.

```
AWSTemplateFormatVersion: 2010-09-09

# VPC
Resources:
  VPC:
    Type: AWS::EC2::VPC
    Properties:
      CidrBlock:
      EnableDnsHostnames: true
      EnableDnsSupport: true
      InstanceTenancy: default
# IGW
# Route Tables
# Subnets
# Subnet A
# Subnet B
# Subnet C
```
  
In our ./bin/cfn directory, we create a new script named networking-deploy.

```
#! /usr/bin/env bash
set -e #stop the execution of the script if it fails

CFN_PATH="/workspace/aws-bootcamp-cruddur-2023/aws/cfn/networking/template.yaml"

cfn-lint $CFN_PATH 

aws cloudformation deploy \
    --stack-name "Cruddur" \
    --s3-bucket $CFN_BUCKET \
    --template-file $CFN_PATH \
    --no-execute-changeset \
    --capabilities CAPABILITY_NAMED_IAM

```
  
We set the value for a variable named CFN_PATH to the path for our template.yaml file for our network layer.

Next, we deploy a CloudFormation stack using the aws cloudformation deploy command. Here are the options and arguments used:

--stack-name: Specifies the name of the stack to create or update. In this case, it's set to "Cruddur".

--s3-bucket: Specifies the S3 bucket to upload the CloudFormation template to. The value of the CFN_BUCKET variable is expected to be set somewhere else in the script or in the environment.

--template-file: Specifies the path to the CloudFormation template file, which is set to the value of the CFN_PATH variable.

--no-execute-changeset: Indicates that the changeset created during the deployment should not be executed immediately. It allows you to review the changes before applying them.

--capabilities CAPABILITY_NAMED_IAM: Specifies the IAM capabilities required to create or update IAM resources in the CloudFormation stack. This capability is necessary when the template includes IAM resources.

```
export CFN_BUCKET="cfn-artifacts-1"
gp env CFN_BUCKET="cfn-artifacts-1"
```



